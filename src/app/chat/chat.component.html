<ng-container *ngIf="chat$ | async as chat">
  <ng-container *ngIf="auth.user$ | async as user">

    <div class="top">
      <p><a class="tag" routerLink="/">Back</a>
        <span class="tag is-success">
          {{ this.href }}
        </span>
      </p>
    </div>

    <div class="chat">

      <div class="animate__animated animate__zoomInUp"
           [ngClass]="msg.sender.uid === user.uid ? 'msg_owner' : 'msg' "
           *ngFor="let msg of chat; trackBy: trackByCreated">

        <div class="user">
          <img [src]="msg.sender.photoURL || 'assets/user.svg'" alt="User Icon" width="50px">
          <div><span class="tag is-dark">{{msg.sender.displayName}}</span></div>

        </div>

        <div>
          <a *ngIf="msg.imageURL" [href]="msg.imageURL"><img [src]="msg.imageURL" alt="Image" width="200"></a>
          <audio *ngIf="msg.audioURL" [src]="msg.audioURL" controls></audio><br>
          <p>{{msg.text}}</p>
        </div>


      </div>

    </div>

    <div class="form">
      <div>
        <input type="file" accept="image/*" (change)="onselectImage($event)" hidden #addImage>

        <button class="button is-info" (click)="addImage.click()">Add Image</button>

        <img *ngIf="imageUrl" alt="Image Preview" [src]="imageUrl" (click)="imageUrl = null" width="150">
      </div>

      <div>
        <button *ngIf="!recorder; else elseBlock" (click)="record()" class="button is-info">Record Audio</button>

        <ng-template #elseBlock>
          <button class="button is-info" (click)="stop()">Stop</button>
        </ng-template>

        <audio *ngIf="newAudio" [src]="newAudioURL()" controls></audio>
      </div>

      <div>
        <input class="input" [(ngModel)]="newMsg" maxlength="100" (keydown.enter)="submit()">

        <button (click)="submit()" class="button is-info" [disabled]="!newMsg">Send</button>
      </div>

    </div>

  </ng-container>
</ng-container>
